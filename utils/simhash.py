import hashlib
from utils.tokenizer import tokenize

class SimHash:
    def __init__(self, b=128):
        self.b = b  # Number of bits in the fingerprint

    def _hash_word(self, word):
        encoded_word = word.encode('utf-8') # Encode the word into bytes using UTF-8 encoding
        md5_hash = hashlib.md5()            # Create an MD5 hash object
        md5_hash.update(encoded_word)       # Update the hash object with the encoded word
        hex_digest = md5_hash.hexdigest()   # Get the hexadecimal digest of the hash
        hash_value = int(hex_digest, 16)    # Convert the hexadecimal digest to an integer with base 16
        return bin(hash_value)[2:].zfill(self.b)[-self.b:]  # Convert hash value to binary and ensure it is b bits long

    def _calculate_frequencies(self, tokens):
        # Calculate word frequencies
        freq = {}
        for token in tokens:
            if token in freq:
                freq[token] += 1
            else:
                freq[token] = 1
        return freq


    def compute_simhash(self, text):
        tokens = tokenize(text)
        frequencies = self._calculate_frequencies(tokens)
        
        V = [0] * self.b
        
        for word, weight in frequencies.items():
            hash_value = self._hash_word(word)
            for i in range(self.b):
                if hash_value[i] == '1':
                    V[i] += weight
                else:
                    V[i] -= weight
        
        fingerprint = ''.join(['1' if v > 0 else '0' for v in V])
        return fingerprint

    def hamming_distance(self, hash1, hash2):
        # Calculate the Hamming distance between two hashes
        return sum(c1 != c2 for c1, c2 in zip(hash1, hash2))

    def similarity(self, text1, text2):
        hash1 = self.compute_simhash(text1)
        hash2 = self.compute_simhash(text2)
        distance = self.hamming_distance(hash1, hash2)
        return 1 - distance / self.b

    def are_near_duplicates(self, text1, text2, threshold=0.8):
        return self.similarity(text1, text2) >= threshold


# Test the SimHash class
simhasher = SimHash()

text1 = """
\n\n\n\n\n\n\n\n\nInformatics Department Receives $1.1M to Study Socially Responsible AI | Informatics @ the University of California, Irvine\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPeople\nContact\nSite Map\nNews\n\n\n\n\nSearch for:\n\n\n\n \n\n\n\n\n\nMenu\nSkip to content\nExplore\n\n\nChair\u2019s Welcome\nFaculty Profiles\nBooks We Read\nHistory of the Department\nSeminar Series\nBlogs We Author\nDepartment Vision\nBooks We Have Written\nVisiting the Department\nFacts & Figures\n\n\n\nGraduate Degrees\n\n\nOverview\nPh.D. Software Engineering\nPolicies\nPh.D. Informatics\nM.S. Software Engineering\nDiversity Ambassador\nM.S. Informatics\nMaster of Software Engineering\nStudent Profiles\nMaster of Human-Computer Interaction & Design\nCourses\nStudent Groups\n\u00a0\n\u00a0\nUpcoming Course Schedule\n\n\n\nUndergraduate Degrees\n\n\nB.S. Informatics\nB.S. Information & Computer Science\nPolicies\nB.S. Business Information Management\nSpecial Opportunities\nStudent Profiles\nB.S. Computer Game Science\nMinors\nStudent Groups\nB.S. Software Engineering\nCourses\nUpcoming Course Schedule\n\n\n\nAdmissions\n\n\nGraduate Application Process\nComing from Abroad\nHousing\nUndergraduate Application Process\nStudent Life\n\n\n\nResearch\n\n\nLabs & Centers\nPh.D. Research\nUndergraduate Research\nAreas of Expertise\nPast Dissertations\nGifts & Grants\nExample Projects\nMasters Research\n\n\n\nImpact\n\n\nResearch that Matters\nUndergraduate Alumni Spotlights\nOutreach\nGraduate Alumni Spotlights\nCommunity Engagement\n\n\n\nSupport\n\n\nChampion Research\nBecome a Corporate Partner\nShare Your Talent\nSupport Students\nProvide Projects\nSet Future Agenda\nBe a Mentor\nPost Jobs\n\n\n\n\n\n\nMenuExplore\n\nChair\u2019s Welcome\nHistory of the Department\nDepartment Vision\nFacts & Figures\nFaculty Profiles\nSeminar Series\nBooks We Have Written\nBooks We Read\nBlogs We Author\nVisiting the Department\n\n\nGraduate Degrees\n\nPh.D. Informatics\nM.S. Informatics\nPh.D. Software Engineering\nM.S. Software Engineering\nMaster of Human-Computer Interaction & Design\nMaster of Software Engineering\nCourses\nPolicies\nDiversity Ambassador\nStudent Profiles\nStudent Groups\nUpcoming Course Schedule\n\n\nUndergraduate Degrees\n\nB.S. Informatics\nB.S. Business Information Management\nB.S. Computer Game Science\nB.S. Software Engineering\nB.S. Information & Computer Science\nSpecial Opportunities\nMinors\nCourses\nPolicies\nStudent Profiles\nStudent Groups\nUpcoming Course Schedule\n\n\nAdmissions\n\nGraduate Application Process\nUndergraduate Application Process\nComing from Abroad\nStudent Life\nHousing\n\n\nResearch\n\nLabs & Centers\nAreas of Expertise\nExample Projects\nPh.D. Research\nPast Dissertations\nMasters Research\nUndergraduate Research\nGifts & Grants\n\n\nImpact\n\nResearch that Matters\nGraduate Alumni Spotlights\nUndergraduate Alumni Spotlights\nCommunity Engagement\nOutreach\n\n\nSupport\n\nChampion Research\nSupport Students\nBe a Mentor\nBecome a Corporate Partner\nProvide Projects\nPost Jobs\nShare Your Talent\nSet Future Agenda\n\n\n \n\n\n\n\n\n\n\n\t\t\u2190 Site Map\u00a0\u00a0News\n\n\n\n\n\nInformatics Department Receives $1.1M to Study Socially Responsible AI\nJanuary 16, 2019\n\n\nHow do we build systems that proactively promote values of inclusion? This is one of the questions the\u00a0Department of\u00a0Informatics\u00a0hopes to tackle over the next few years, thanks to a\u00a0Graduate Assistance in Areas of National Need (GAANN) award from the U.S. Department of Education (DoE). The award of $895,000, combined with $222,875 in cost-sharing funds from the UCI\u00a0Graduate Division, will support seven informatics Ph.D. fellowships for students researching socially responsible AI.\n\nIn years past, the department has received GAANN awards for general informatics research, but the DoE program has since narrowed its focus. Within the field of computer and information sciences, GAANN is now targeting AI, along with cybersecurity and secure computer programming, as its \u201careas of national need.\u201d Yet this change in focus did not deter\u00a0Chancellor\u2019s Professor of Informatics\u00a0Paul Dourish\u00a0from leading the application effort.\nWith much of the department\u2019s research considering the social impact of data analytics and AI or the ethics and social values of technological design, Dourish decided to work with colleagues to put together a proposal under the AI umbrella. \u201cSocially responsible AI is an area of public interest and considerable public debate, and it\u2019s an area in which, within informatics, we have a lot of skills, experience and connections.\u201d The proposal\u2019s perfect score affirms the department\u2019s potential for significant contributions in the AI space.\nDourish says some of the resulting research might focus directly on the ethical implications of AI but could also consider data analytics in areas such as healthcare, education, governance or criminal justice. In addition, he encourages researchers to view AI as more than just a \u201cproblem\u201d to be fixed. \u201cA lot of the conversation is around how one might avoid, for instance, algorithmic bias,\u201d he says. Although he agrees that eliminating sources of systematic bias in technological platforms is important, he asserts that \u201cthe more interesting question is, \u2018how can you use these technologies not just to avoid the problem but to actually promote social values?\u2019\u201d\nIn fact, the proposal highlights both perspectives as areas of investigation, referring to \u201cresponsible\u201d as well as \u201cresponsive\u201d AI. The former focuses on \u201chow systems can be developed to avoid problems of bias, uneven access, discriminatory applications, and invasions of privacy,\u201d while the latter aims to understand \u201chow AI can be harnessed to promote social welfare, inclusiveness, economic progress and justice.\u201d\nDourish is optimistic about the GAANN fellowships starting new conversations in these areas that will lead to novel research \u2014 inside the Department of Informatics and beyond.\n\u2014\u00a0Shani Murray\n\n\n\nPost navigation\n\u2190 BBC: \u201cWhy an off-the-grid hour at work is so crucial\u201d (Gloria Mark quoted)\nESPN Esports College League of Legends Week 1 rankings \u2192\n\n\n\n\n\n\n  \nOctober 2019\nSeptember 2019\nAugust 2019\nJuly 2019\nJune 2019\nMay 2019\nApril 2019\nMarch 2019\nFebruary 2019\nJanuary 2019\nDecember 2018\nNovember 2018\nOctober 2018\nSeptember 2018\nAugust 2018\nJuly 2018\nJune 2018\nMay 2018\nApril 2018\nMarch 2018\nFebruary 2018\nJanuary 2018\nDecember 2017\nNovember 2017\nOctober 2017\nSeptember 2017\nAugust 2017\nJuly 2017\nJune 2017\nMay 2017\nApril 2017\nMarch 2017\nFebruary 2017\nJanuary 2017\nDecember 2016\nNovember 2016\nOctober 2016\nSeptember 2016\nAugust 2016\nJuly 2016\nJune 2016\nMay 2016\nApril 2016\nMarch 2016\nFebruary 2016\nJanuary 2016\nDecember 2015\nNovember 2015\nOctober 2015\nSeptember 2015\nAugust 2015\nJuly 2015\nJune 2015\nMay 2015\nApril 2015\nMarch 2015\nFebruary 2015\nJanuary 2015\nDecember 2014\nNovember 2014\nSeptember 2014\nAugust 2014\nJuly 2014\nJune 2014\n\n \n\n\n\nPeople\nContact\nSite Map\nNews\n\n\n\n\n\n\n\nFeedback\nPrivacy Policy\n\t\t\t\t\t\u00a9 2019 UC Regents\n\t\t\t\t\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n
"""
text2 = """
\n\n\n\n\n\n\n\n\nJune | 2017 | Informatics @ the University of California, Irvine | Page 2\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPeople\nContact\nSite Map\nNews\n\n\n\n\nSearch for:\n\n\n\n \n\n\n\n\n\nMenu\nSkip to content\nExplore\n\n\nChair\u2019s Welcome\nFaculty Profiles\nBooks We Read\nHistory of the Department\nSeminar Series\nBlogs We Author\nDepartment Vision\nBooks We Have Written\nVisiting the Department\nFacts & Figures\n\n\n\nGraduate Degrees\n\n\nOverview\nPh.D. Software Engineering\nPolicies\nPh.D. Informatics\nM.S. Software Engineering\nDiversity Ambassador\nM.S. Informatics\nMaster of Software Engineering\nStudent Profiles\nMaster of Human-Computer Interaction & Design\nCourses\nStudent Groups\n\u00a0\n\u00a0\nUpcoming Course Schedule\n\n\n\nUndergraduate Degrees\n\n\nB.S. Informatics\nB.S. Information & Computer Science\nPolicies\nB.S. Business Information Management\nSpecial Opportunities\nStudent Profiles\nB.S. Computer Game Science\nMinors\nStudent Groups\nB.S. Software Engineering\nCourses\nUpcoming Course Schedule\n\n\n\nAdmissions\n\n\nGraduate Application Process\nComing from Abroad\nHousing\nUndergraduate Application Process\nStudent Life\n\n\n\nResearch\n\n\nLabs & Centers\nPh.D. Research\nUndergraduate Research\nAreas of Expertise\nPast Dissertations\nGifts & Grants\nExample Projects\nMasters Research\n\n\n\nImpact\n\n\nResearch that Matters\nUndergraduate Alumni Spotlights\nOutreach\nGraduate Alumni Spotlights\nCommunity Engagement\n\n\n\nSupport\n\n\nChampion Research\nBecome a Corporate Partner\nShare Your Talent\nSupport Students\nProvide Projects\nSet Future Agenda\nBe a Mentor\nPost Jobs\n\n\n\n\n\n\nMenuExplore\n\nChair\u2019s Welcome\nHistory of the Department\nDepartment Vision\nFacts & Figures\nFaculty Profiles\nSeminar Series\nBooks We Have Written\nBooks We Read\nBlogs We Author\nVisiting the Department\n\n\nGraduate Degrees\n\nPh.D. Informatics\nM.S. Informatics\nPh.D. Software Engineering\nM.S. Software Engineering\nMaster of Human-Computer Interaction & Design\nMaster of Software Engineering\nCourses\nPolicies\nDiversity Ambassador\nStudent Profiles\nStudent Groups\nUpcoming Course Schedule\n\n\nUndergraduate Degrees\n\nB.S. Informatics\nB.S. Business Information Management\nB.S. Computer Game Science\nB.S. Software Engineering\nB.S. Information & Computer Science\nSpecial Opportunities\nMinors\nCourses\nPolicies\nStudent Profiles\nStudent Groups\nUpcoming Course Schedule\n\n\nAdmissions\n\nGraduate Application Process\nUndergraduate Application Process\nComing from Abroad\nStudent Life\nHousing\n\n\nResearch\n\nLabs & Centers\nAreas of Expertise\nExample Projects\nPh.D. Research\nPast Dissertations\nMasters Research\nUndergraduate Research\nGifts & Grants\n\n\nImpact\n\nResearch that Matters\nGraduate Alumni Spotlights\nUndergraduate Alumni Spotlights\nCommunity Engagement\nOutreach\n\n\nSupport\n\nChampion Research\nSupport Students\nBe a Mentor\nBecome a Corporate Partner\nProvide Projects\nPost Jobs\nShare Your Talent\nSet Future Agenda\n\n\n \n\n\n\n\n\n\n\n\n\nMonthly Archives: June 2017\n\n\n\n\nWired: \u201cBanned From the US? There\u2019s a Robot for That\u201d (Mark quoted)\n\nJune 5, 2017\n\n\nTwo telepresence robots roll into a human-computer interaction conference. Sounds like the beginning of a very nerdy joke, but it really happened (#2017). A few weeks ago in Denver, Colorado, a robot I was piloting over the internet from my computer in Idaho stood wheel-to-wheel with a similar \u2018bot in a pink skirt controlled by a researcher in Germany. We huddled. We introduced ourselves by yelling at each other\u2019s screens. Given the topic of the conference, this particular human-computer interaction was a little too on the HD touch-screen nose. But as much as the huddle symbolized of the future, it was also a political statement about a troubled present.\n\u201cIt is a political statement, right? That we can allow people to come,\u201d says Gloria Mark, General Chair of CHI and a professor of informatics at the University of California, Irvine. She says that even with the telepresence robots reserved for people wth denied visas, the conference still lost some attendees over the looming ban. \u201cThey just didn\u2019t even want to take a chance of coming,\u201d she said.\nRead the full story at Wired.\n\n\n\n\n\nNardi publishes book on the computerization of the economy\n\nJune 2, 2017\n\n\nInformatics Professor Bonnie Nardi has published a new book on the computerization of the economy titled Heteromation, and Other Stories of Computing and Capitalism. Co-written with Hamid R. Ekbia, a professor of informatics, cognitive science and international studies at Indiana University Bloomington, together they investigate the often \u201chidden\u201d participation of digital technology users that yield economic value for companies via an essentially free labor force in computer-mediated networks. Nardi and Ekbia have coined this practice as \u201cheteromation.\u201d\u00a0 In their book, they consider different types of heteromated labor of capital accumulation, such as \u201ccommunicative labor, seen in user-generated content on social media; cognitive labor, including microwork and self-service; creative labor, from gaming environments to literary productions; emotional labor, often hidden within paid jobs; and organizing labor, made up of collaborative oups such as citizen scientists.\u201d\nThe hardcover and e-book versions of Heteromation are available for purchase from MIT Press.\n\n\n\n\n\nFast Company: \u201cThanks To Telepresence Robots, Kids Can Attend School From Home\u201d (Judy Olson cited)\n\nJune 1, 2017\n\n\nThe machines, usually paid for either with funding for students with special needs or from grants and donations, allow students who might otherwise be socially isolated to stay in touch and even make eye contact with classmates and teachers. That helps keep their spirits up and helps them stay motivated academically, according to Judy Olson, a professor at the Department of Informatics at the University of California, Irvine. Olson is the coauthor of a paper on telepresence robots in education that was presented at the Association for Computing Machinery\u2019s recent annual conference on human-computer interaction.\nRead the full story at Fast Company.\n\n\n\nPost navigation\n\nNewer posts \u2192\n\n\n\n\n  \nOctober 2019\nSeptember 2019\nAugust 2019\nJuly 2019\nJune 2019\nMay 2019\nApril 2019\nMarch 2019\nFebruary 2019\nJanuary 2019\nDecember 2018\nNovember 2018\nOctober 2018\nSeptember 2018\nAugust 2018\nJuly 2018\nJune 2018\nMay 2018\nApril 2018\nMarch 2018\nFebruary 2018\nJanuary 2018\nDecember 2017\nNovember 2017\nOctober 2017\nSeptember 2017\nAugust 2017\nJuly 2017\nJune 2017\nMay 2017\nApril 2017\nMarch 2017\nFebruary 2017\nJanuary 2017\nDecember 2016\nNovember 2016\nOctober 2016\nSeptember 2016\nAugust 2016\nJuly 2016\nJune 2016\nMay 2016\nApril 2016\nMarch 2016\nFebruary 2016\nJanuary 2016\nDecember 2015\nNovember 2015\nOctober 2015\nSeptember 2015\nAugust 2015\nJuly 2015\nJune 2015\nMay 2015\nApril 2015\nMarch 2015\nFebruary 2015\nJanuary 2015\nDecember 2014\nNovember 2014\nSeptember 2014\nAugust 2014\nJuly 2014\nJune 2014\n\n \n\n\n\nPeople\nContact\nSite Map\nNews\n\n\n\n\n\n\n\nFeedback\nPrivacy Policy\n\t\t\t\t\t\u00a9 2019 UC Regents\n\t\t\t\t\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n
"""

hash1 = simhasher.compute_simhash(text1)
hash2 = simhasher.compute_simhash(text2)

distance = simhasher.hamming_distance(hash1, hash2)

similarity = simhasher.similarity(text1, text2)
near_duplicates = simhasher.are_near_duplicates(text1, text2)

print(f"Hash 1: {hash1}")
print(f"Hash 2: {hash2}")

print(f"Hamming Distance: {distance}")
print(f"Similarity: {similarity}")
print(f"Near Duplicates: {near_duplicates}")